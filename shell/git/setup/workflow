#!/usr/bin/env bash

set -e

# make and cd directory
AUTHOR="NikoboiNFTB"
# TARGET_DIR="$HOME/GitHub/$AUTHOR"
TARGET_DIR="$HOME/GitHub/test/$AUTHOR"
mkdir -p "$TARGET_DIR"
cd "$TARGET_DIR"

# Ensure jq is installed
if ! command -v jq &> /dev/null; then
    echo "Error: jq is required but not installed."
    exit 1
fi


# Get repo names
echo "Fetching list of repositories for user '$AUTHOR'..."
repos=$(curl -s "https://api.github.com/users/$AUTHOR/repos?per_page=100" | jq -r '.[].name')
if [ -z "$repos" ]; then
    echo "No repositories found or failed to fetch from GitHub."
    exit 1
fi
echo "Found $(echo "$repos" | wc -w) repositories. Cloning/pulling all in parallel..."

# Clone
for repo in $repos; do
    (
        if [ -d "$repo/.git" ]; then
            echo "Updating $repo..."
            cd "$repo" && git pull --quiet
        else
            echo "Cloning $repo..."
            git clone --quiet "git@github.com:$AUTHOR/$repo.git"
        fi
    ) &
done

wait

echo "All cloning/pulling tasks completed!"
